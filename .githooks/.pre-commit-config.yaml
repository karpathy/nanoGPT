repos:

- repo: https://github.com/astral-sh/ruff-pre-commit
  rev: v0.9.6
  hooks:
  - id: ruff
    args: [--fix]
  - id: ruff-format
- repo: https://github.com/executablebooks/mdformat
  rev: 0.7.22
  hooks:
  - id: mdformat
    args: [--check]
    additional_dependencies:
      - mdformat-gfm
      - mdformat-frontmatter
      - mdformat-tables
    files: '^(docs|src/ml_playground|tests|\.dev-guidelines)/.*\.md$|^[^/]+\.md$'
- repo: local
  hooks:
  - id: coverage-threshold
    name: coverage threshold (>=87.00%)
    entry: bash
    args:
      - -c
      - |
        set -euo pipefail
        COVERAGE_DIR=".cache/coverage"
        CACHE_GLOB="${COVERAGE_DIR}/coverage.sqlite*"
        mkdir -p "${COVERAGE_DIR}"
        if ! compgen -G "${CACHE_GLOB}" > /dev/null; then
          rm -f "${CACHE_GLOB}"
          uv run ci-tasks coverage-test
        fi
        if ! compgen -G "${COVERAGE_DIR}/coverage.sqlite"* > /dev/null; then
          echo "[error] No coverage data; run 'uv run ci-tasks coverage-test'." >&2
          exit 2
        fi
        if compgen -G "${COVERAGE_DIR}/coverage.sqlite."* > /dev/null; then
          COVERAGE_FILE="${COVERAGE_DIR}/coverage.sqlite" uv run coverage combine
        fi
        COVERAGE_FILE="${COVERAGE_DIR}/coverage.sqlite" uv run coverage report -m
        uv run python tools/ci_tasks.py coverage-threshold --line-threshold 87 --branch-threshold 78
    language: system
    pass_filenames: false
- repo: local
  hooks:
  - id: pyright
    name: pyright
    entry: bash
    args:
      - -c
      - |
        set -euo pipefail
        uv run pyright src/ml_playground
    language: system
    pass_filenames: false
- repo: local
  hooks:
  - id: mypy
    name: mypy
    entry: bash
    args:
      - -c
      - |
        set -euo pipefail
        uv run mypy --incremental
    language: system
    pass_filenames: false
- repo: https://github.com/jendrikseipp/vulture
  rev: v2.11
  hooks:
  - id: vulture
    args: [src/ml_playground, --min-confidence, '90']
    pass_filenames: false
