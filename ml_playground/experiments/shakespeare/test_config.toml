# Minimal test configuration for Shakespeare experiment to keep CLI tests fast.

#[ Minimal sheakespeare test config aligned with ExperimentConfig schema ]

[prepare]
dataset_dir = "./datasets"
raw_dir = "./raw"
raw_text_path = "./raw/input.txt"
tokenizer_type = "char"

[train.model]
n_layer = 1
n_head = 2
n_embd = 32
block_size = 32
dropout = 0.0
bias = false

[train.data]
batch_size = 1
grad_accum_steps = 1
block_size = 32
ngram_size = 1
sampler = "sequential"

[train.optim]
learning_rate = 0.001
weight_decay = 0.0
beta1 = 0.9
beta2 = 0.95
grad_clip = 1.0

[train.runtime]
out_dir = "./out/test_run"
max_iters = 1
eval_interval = 1
eval_iters = 1
log_interval = 1
eval_only = false
always_save_checkpoint = false
seed = 42
device = "cpu"
dtype = "float32"
compile = false
ckpt_time_interval_minutes = 0
best_smoothing_alpha = 0.0
early_stop_patience = 0
ema_decay = 0.0

[train.runtime.checkpointing.keep]
last = 1
best = 1

[train.extras]
ckpt_last_filename = "ckpt_last.pt"
ckpt_best_filename = "ckpt_best.pt"
ckpt_metric = "val_loss"
ckpt_greater_is_better = false
ckpt_atomic = true
ckpt_write_metadata = false

[sample.runtime]
out_dir = "./out/test_run"
device = "cpu"
dtype = "float32"
compile = false
seed = 42

[sample.sample]
start = ""
num_samples = 1
max_new_tokens = 4
temperature = 0.8
top_k = 0

[shared]
experiment = "shakespeare"
config_path = "test_config.toml"
project_home = "."
dataset_dir = "./datasets"
train_out_dir = "./out/test_run"
sample_out_dir = "./out/test_run"
