#!/usr/bin/env bash
# Pre-commit hook to run the quality gate. Fails the commit on any gate failure.
# Requires uv; if uv is unavailable, try running via system python.

set -euo pipefail

echo "[pre-commit] Vulture (dead code scanning)"
uv run vulture ml_playground --min-confidence 90
echo "[pre-commit] Core quality gates (ruff, format, pyright, mypy, pytest)"
PRE_COMMIT=1 make quality

# Best-effort: run a quick mutation test (non-blocking); rely on pyproject.toml for config
echo "[pre-commit] Running quick mutation test (non-blocking)"
uv run cosmic-ray init pyproject.toml out/cosmic-ray/session.sqlite >/dev/null 2>&1 || true
uv run cosmic-ray exec pyproject.toml out/cosmic-ray/session.sqlite || true
