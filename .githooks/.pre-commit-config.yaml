repos:

- repo: https://github.com/astral-sh/ruff-pre-commit
  rev: v0.9.6
  hooks:
  - id: ruff
    args: [--fix]
  - id: ruff-format
- repo: https://github.com/executablebooks/mdformat
  rev: 0.7.17
  hooks:
  - id: mdformat
    additional_dependencies:
      - mdformat-gfm
    files: '(README|CONTRIBUTING|LICENSE|CHANGELOG)\.md$|^(docs|tests|\.dev-guidelines)/.*\.md$'
- repo: https://github.com/checkmake/checkmake.git
  # Or another commit hash or version
  rev: 0.2.2
  hooks:
  # Use this hook to let pre-commit build checkmake in its sandbox
  - id: checkmake
- repo: local
  hooks:
  - id: coverage-threshold
    name: coverage threshold (>=87.00%)
    entry: bash
    args:
      - -c
      - |
        set -euo pipefail
        COVERAGE_DIR=".cache/coverage"
        CACHE_GLOB="${COVERAGE_DIR}/coverage.sqlite*"
        mkdir -p "${COVERAGE_DIR}"
        if ! compgen -G "${CACHE_GLOB}" > /dev/null; then
          echo "[info] generating coverage data"
          rm -f "${CACHE_GLOB}"
          make coverage-test
        else
          echo "[info] reusing cached coverage data"
        fi
        if ! compgen -G "${COVERAGE_DIR}/coverage.sqlite"* > /dev/null; then
          echo "[error] No coverage data found. Run 'make coverage-test' first." >&2
          exit 2
        fi
        if compgen -G "${COVERAGE_DIR}/coverage.sqlite."* > /dev/null; then
          COVERAGE_FILE="${COVERAGE_DIR}/coverage.sqlite" uv run coverage combine
        fi
        COVERAGE_FILE="${COVERAGE_DIR}/coverage.sqlite" uv run coverage report -m --fail-under=87.00
    language: system
    pass_filenames: false
  - id: pyright
    name: pyright
    entry: uv run pyright ml_playground
    language: system
    pass_filenames: false
  - id: mypy
    name: mypy
    entry: uv run mypy --incremental ml_playground
    language: system
    pass_filenames: false
  - id: vulture
    name: vulture
    entry: uv run vulture ml_playground --min-confidence 90
    language: system
    pass_filenames: false
